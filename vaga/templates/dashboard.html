{% extends 'base.html' %}
{% block title %}Dashboard{% endblock %}

{% block content %}
<h1 class="text-center mb-4">Mapa de Vagas</h1>

<!-- Grade de Vagas -->
<div id="mapa-vagas-container"
     style="display: grid; gap: 8px; justify-content: center; margin-top: 40px;">
</div>

<!-- Lista de Vagas Ocupadas -->
<div class="mt-5">
    <h3 class="text-center mb-3">ðŸ“‹ Vagas Ocupadas</h3>
    <ul id="lista-vagas-ocupadas" class="list-group mx-auto" style="max-width: 400px;"></ul>
</div>

<!-- Legenda com Totais -->
<div class="mt-5 text-center" style="font-size: 1.25rem; font-weight: 500;">
    <span style="color: #28a745;"><i class="bi bi-square-fill"></i> Vagas Livres:</span> <span id="total-livres"></span>
    &nbsp;&nbsp;&nbsp;
    <span style="color: #dc3545;"><i class="bi bi-square-fill"></i> Vagas Ocupadas:</span> <span id="total-ocupadas"></span>
    &nbsp;&nbsp;&nbsp;
    <span><strong>Total:</strong> <span id="total-geral"></span></span>
</div>

<!-- Bootstrap Icons -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css">

<!-- Script para gerar a grade e a lista -->
<script>
    const vagas = JSON.parse('{{ vagas_status|escapejs }}');
    const colunas = 10;

    const container = document.getElementById('mapa-vagas-container');
    container.style.gridTemplateColumns = `repeat(${colunas}, 1fr)`;

    const listaOcupadas = document.getElementById('lista-vagas-ocupadas');

    let livres = 0;
    let ocupadas = 0;

    vagas.forEach(v => {
        const div = document.createElement('div');
        div.style.width = '70px';
        div.style.height = '70px';
        div.style.borderRadius = '4px';
        div.style.display = 'flex';
        div.style.flexDirection = 'column';
        div.style.alignItems = 'center';
        div.style.justifyContent = 'center';
        div.style.fontWeight = 'bold';
        div.style.color = 'white';
        div.style.fontSize = '11px';
        div.style.padding = '4px';
        div.style.cursor = 'default';
        div.style.textAlign = 'center';

        let texto = `Vaga ${v.numero}`;

        if (v.status === 'livre') {
            div.style.backgroundColor = '#28a745';
            livres++;
        } else {
            div.style.backgroundColor = '#dc3545';
            ocupadas++;

            // Se houver veÃ­culo, exibir no quadrado
            if (v.veiculo) {
                texto += `<br>${v.veiculo.modelo}<br>${v.veiculo.placa}`;

                // TambÃ©m adicionar Ã  lista de vagas ocupadas
                const item = document.createElement('li');
                item.className = 'list-group-item';
                item.textContent = `Vaga ${v.numero} â€” ${v.veiculo.modelo} â€” Placa ${v.veiculo.placa}`;
                listaOcupadas.appendChild(item);
            } else {
                texto += `<br>Sem veÃ­culo`;

                const item = document.createElement('li');
                item.className = 'list-group-item';
                item.textContent = `Vaga ${v.numero} â€” (Sem dados do veÃ­culo)`;
                listaOcupadas.appendChild(item);
            }
        }

        div.innerHTML = texto;
        div.title = texto;
        container.appendChild(div);
    });

    // Atualizar totais na legenda
    document.getElementById('total-livres').textContent = livres;
    document.getElementById('total-ocupadas').textContent = ocupadas;
    document.getElementById('total-geral').textContent = vagas.length;
</script>
{% endblock %}

